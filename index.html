<script type="module">
  import { auth } from "./firebase.js";
  import { registerUser } from "./app.js";

  let qrGenerated = false;

  auth.onAuthStateChanged(user => {
    if (!user) return;
    if (qrGenerated) return;

    qrGenerated = true;

    registerUser(user.uid);

    const qrDiv = document.getElementById("qrcode");
    qrDiv.innerHTML = "";

    new QRCode(qrDiv, {
      text: user.uid,
      width: 280,
      height: 280,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
    });
  });
</script>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>寮別進捗</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 15px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .house {
      margin-bottom: 25px;
      text-align: center;
    }

    .mosaic {
      width: 160px;
      height: 160px;
      margin: 10px auto;
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      grid-template-rows: repeat(10, 1fr);
      background-size: cover;
      background-position: center;
      border-radius: 10px;
      overflow: hidden;
    }

    .gryffindor { background-image: url("gryffindor.png"); }
    .slytherin  { background-image: url("slytherin.png"); }
    .ravenclaw  { background-image: url("ravenclaw.png"); }
    .hufflepuff { background-image: url("hufflepuff.png"); }

    .tile {
      background: rgba(0,0,0,0.85);
    }

    .score {
      margin-top: 6px;
      font-size: 14px;
    }
  </style>
</head>

<body>

<h1>寮別 モザイク進捗</h1>

<div class="house">
  <h3>Gryffindor</h3>
  <div class="mosaic gryffindor" id="gryffindor"></div>
  <div class="score" id="gryffindor-score">0%</div>
</div>

<div class="house">
  <h3>Slytherin</h3>
  <div class="mosaic slytherin" id="slytherin"></div>
  <div class="score" id="slytherin-score">0%</div>
</div>

<div class="house">
  <h3>Ravenclaw</h3>
  <div class="mosaic ravenclaw" id="ravenclaw"></div>
  <div class="score" id="ravenclaw-score">0%</div>
</div>

<div class="house">
  <h3>Hufflepuff</h3>
  <div class="mosaic hufflepuff" id="hufflepuff"></div>
  <div class="score" id="hufflepuff-score">0%</div>
</div>

<script type="module">
  import { db } from "./firebase.js";
  import { doc, onSnapshot } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const TOTAL = 100;

  function render(house, value) {
    const mosaic = document.getElementById(house);
    mosaic.innerHTML = "";

    const v = Math.min(value || 0, TOTAL);

    for (let i = 0; i < TOTAL; i++) {
      const tile = document.createElement("div");
      tile.className = "tile";
      if (i < v) tile.style.display = "none";
      mosaic.appendChild(tile);
    }

    document.getElementById(house + "-score").textContent =
      `完成度 ${v}%`;
  }

  const ref = doc(db, "scores", "houses");

  onSnapshot(ref, snap => {
    if (!snap.exists()) return;
    const d = snap.data();

    render("gryffindor", d.gryffindor);
    render("slytherin",  d.slytherin);
    render("ravenclaw",  d.ravenclaw);
    render("hufflepuff", d.hufflepuff);
  });
</script>

</body>
</html>
